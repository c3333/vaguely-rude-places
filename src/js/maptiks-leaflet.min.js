!function(t,e,i,n){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var i;if(null===this||void 0===this)throw new TypeError('"this" is null or not defined');var n=Object(this),r=n.length>>>0;if(0===r)return-1;var a=+e||0;if(1/0===Math.abs(a)&&(a=0),a>=r)return-1;for(i=Math.max(a>=0?a:r-Math.abs(a),0);r>i;){if(i in n&&n[i]===t)return i;i++}return-1});var r=t.maptiks||{};"object"==typeof i&&"object"==typeof i.exports?i.exports=r:"function"==typeof n&&n.amd&&n(r),t.maptiks=r,r._minifiedObjectPropertyMap={action:"act",category:"cat",clickable:"clck",draggable:"drag",href:"href",icon:"ico",id:"id",initial:"init",internal:"intr",label:"lbl",map_bbox:"bbox",map_center:"cp",map_id:"mid",map_library:"lib",map_session:"msid",map_trackcode:"tid",map_zoom:"zm",marker:"mkr",popup:"pop",popup_active:"popa",position:"pos",position_initial:"posi",session:"lsid",tile_center:"tcp",tile_url:"turl",timestamp:"t",url:"url",value:"vle"},r._server_template="//{s}.maptiks.com/store/a.gif",r._subdomains=["a","b","c","d"],r.debug=r.debug||null,r.standalone=r.standalone||null,r.trackcode=r.trackcode||null,r.version="0.3.5",r.track=r.track||{},r.track.Base=function(t){var e=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/,i=t.session.match(e),n=t.trackcode.match(e);if(null===t.id||void 0===t.id)throw"Maptiks ID must be defined";if(this._id=t.id.toString(),"leaflet"!==t.library&&"gmaps"!==t.library&&"ol3"!==t.library)throw"Library must defined as leaflet, gmaps, or ol3";if(this._library=t.library,null===t.map||void 0===t.map)throw"Map must be defined";if("object"!=typeof t.map)throw"Map must be an object";if(this._map=t.map,"string"!=typeof t.session||""===t.session)throw"Session must be defined";if(!i)throw"Session must be a v4 UUID, use maptiks.utils.generateUUID()";if(this._session=t.session,"string"!=typeof t.trackcode||""===t.trackcode)throw"Trackcode must be defined";if(!n)throw"Trackcode not valid";if(this._trackcode=t.trackcode,null!==t.debug&&void 0!==t.debug){if("boolean"!=typeof t.debug)throw"Debug must be true or false";this._debug=t.debug}else this._debug=!1;if(null!==t.standalone&&void 0!==t.standalone){if("boolean"!=typeof t.standalone)throw"Standalone must be true or false";this._standalone=t.standalone}else this._standalone=!1;if(null===t.getMapState||void 0===t.getMapState)throw"getMapState must be defined";if("function"!=typeof t.getMapState)throw"getMapState must be a function";this.getMapState=t.getMapState},r.track.Base.mixin=function(t){r.utils.extend(r.track.Base.prototype,t)},r.track.Base.prototype={constructor:function(){},_subdomain_index:0,_getServerUrl:function(){var t;return this._subdomain_index>=r._subdomains.length&&(this._subdomain_index=0),t=r.utils.template(r._server_template,{s:r._subdomains[this._subdomain_index]}),this._subdomain_index++,t},_isInitial:function(){return(new Date).getTime()-this._initialTime<this._initialTimeout},_minifyObjectPropertyNames:function(t){var e=r._minifiedObjectPropertyMap,i={};for(var n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[e[n]]=t[n]:i[n]=t[n];return i},getId:function(){return this._id},getLibrary:function(){return this._library},getMapState:function(){throw"getMapState has not been overriden with map library"},getSession:function(){return this._session},getTrackcode:function(){return this._trackcode},track:function(t,i){var n,a,o,s,c=new Image,u=[],p=this.getMapState();if("object"==typeof t&&t!=={}){t.map_id=this.getId(),t.map_library=this.getLibrary(),t.map_session=this.getSession(),t.map_trackcode=this.getTrackcode(),t.map_bbox=p.bbox,t.map_center=p.center,t.map_zoom=p.zoom,t.timestamp=(new Date).getTime(),t=this._minifyObjectPropertyNames(t);for(s in t)if(t.hasOwnProperty(s)){if(a=t[s],o=typeof a,Array.isArray(t[s]))a=a.join(",");else if(-1===["string","number","boolean"].indexOf(o))continue;u.push(encodeURIComponent(s)+"="+encodeURIComponent(a))}if(e&&(this._debug||r.debug||"debug"===i)){e.log("***");for(var l in u)u.hasOwnProperty(l)&&e.log(decodeURIComponent(u[l]).replace("=",": "))}else"test"===i||(n=this._getServerUrl(),c.src=n+"?"+u.join("&"));return t}}},r.track.Map=function(){},r.track.Map.mixin=function(t){r.utils.extend(r.track.Map.prototype,t)},r.track.Map.prototype={constructor:function(){},_mapSessionTracked:null,getMap:function(){return this._map},_trackMap:function(t){this._standalone||this.track({category:t.category,action:t.action,label:t.label,internal:!0})},trackMapSession:function(){this._mapSessionTracked||(this._mapSessionTracked=!0,this._trackMap({category:"map",action:"mapload",label:"mapsession"}))},trackPanZoom:function(){this.getMapState().zoom===this._zoom?this._trackMap({category:"map",action:"mapactivity",label:"pan"}):this._zoom&&this._trackMap({category:"map",action:"mapactivity",label:"zoom"}),this._zoom=this.getMapState().zoom}},r.track.Layer=function(){},r.track.Layer.mixin=function(t){r.utils.extend(r.track.Layer.prototype,t)},r.track.Layer.prototype={constructor:function(){},_layers:null,_trackLayer:function(t,e){this._standalone||this.track({category:e.category,action:e.action,label:e.label,value:e.value,id:t.getId(),session:t.getSession(),url:t.getUrl(),tile_center:e.tile_center,tile_url:e.tile_url,internal:!0})},getLayers:function(){return this._layers},getActiveLayers:function(){for(var t=[],e=0;e<this._layers.length;e++)this._layers[e].maptiks._session&&t.push(this._layers[e]);return t},getInactiveLayers:function(){for(var t=[],e=0;e<this._layers.length;e++)this._layers[e].maptiks._session||t.push(this._layers[e]);return t},trackLayerAdd:function(t){t._session=r.utils.generateUUID(),t=r.utils.createTimer(t),r.utils.pushUnique(this._layers,t._layer),this._trackLayer(t,{category:"layersession",action:"statechange",label:"active"})},trackLayerRemove:function(t){this._trackLayer(t,{category:"layersession",action:"statechange",label:"inactive"}),t._session=null},trackLayerLoad:function(t){t._timer&&t.getSession()&&this._trackLayer(t,{category:"tlayer",action:"layerload",value:t._timer.stop()})},trackTileError:function(t,e,i){this._trackLayer(t,{category:"tlayer",action:"tileerror",tile_center:e,tile_url:i})}},r.track.Marker=function(){},r.track.Marker.mixin=function(t){r.utils.extend(r.track.Marker.prototype,t)},r.track.Marker.prototype={constructor:function(){},_markers:null,_trackMarker:function(t,e){var i=this;this._standalone||setTimeout(function(){i.track({category:"marker",action:e.action,value:e.value,id:t.getId(),icon:t.getIcon(),position:t.getPosition(),position_initial:e.position,popup:t.hasPopup(),popup_active:t.isPopupActive(),clickable:t.isClickable(),draggable:t.isDraggable(),internal:!0})},0)},getMarkers:function(){return this._markers},getActiveMarkers:function(){for(var t=[],e=0;e<this._markers.length;e++)this._markers[e].maptiks._active&&t.push(this._markers[e]);return t},getInactiveMarkers:function(){for(var t=[],e=0;e<this._markers.length;e++)this._markers[e].maptiks._active||t.push(this._markers[e]);return t},trackMarkerAdd:function(t){t._active=!0,t=r.utils.createTimer(t),r.utils.pushUnique(this._markers,t._marker),this._trackMarker(t,{action:"add"})},trackMarkerClick:function(t){this._trackMarker(t,{action:"click"})},trackMarkerRemove:function(t){t._timer&&(t._active=!1,this._trackMarker(t,{action:"remove",value:t._timer.stop()}))},trackMarkerDrag:function(t,e){t._timer._timer&&this._trackMarker(t,{action:"drag",value:t._timer._timer.stop(),position:e})}},r.track.Popup=function(){},r.track.Popup.mixin=function(t){r.utils.extend(r.track.Popup.prototype,t)},r.track.Popup.prototype={constructor:function(){},_popups:null,_trackPopup:function(t,e){this._standalone||this.track({category:"popup",action:e.action,value:e.value,href:e.href,id:t.getId(),position:t.getPosition(),marker:t.hasMarker(),icon:t.getMarkerIcon(),internal:!0})},getPopups:function(){return this._popups},getActivePopups:function(){for(var t=[],e=0;e<this._popups.length;e++)this._popups[e].maptiks._active&&t.push(this._popups[e]);return t},getInactivePopups:function(){for(var t=[],e=0;e<this._popups.length;e++)this._popups[e].maptiks._active||t.push(this._popups[e]);return t},trackPopupAdd:function(t){t._active=!0,t=r.utils.createTimer(t),r.utils.pushUnique(this._popups,t._popup),this._trackPopup(t,{action:"add"})},trackPopupRemove:function(t){t._timer&&(t._active=!1,this._trackPopup(t,{action:"remove",value:t._timer.stop()}))},trackPopupNavigate:function(t,e){t._timer&&(this._trackPopup(t,{action:"navigate",value:t._timer.stop(),href:e}),t=r.utils.createTimer(t))}},r.track=r.track||{},r.track.Source=function(){},r.track.Source.mixin=function(t){r.utils.extend(r.track.Source.prototype,t)},r.track.Source.prototype={constructor:function(){},_sources:null,getSources:function(){return this._sources},getActiveSources:function(){for(var t=[],e=0;e<this._sources.length;e++)this._sources[e].maptiks.isActive()&&t.push(this._sources[e]);return t},getInactiveSources:function(){for(var t=[],e=0;e<this._sources.length;e++)this._sources[e].maptiks.isActive()||t.push(this._sources[e]);return t}},r.layer=r.layer||{},r.layer.Base=function(){},r.layer.Base.mixin=function(t){r.utils.extend(r.layer.Base.prototype,t)},r.layer.Base.prototype={constructor:function(){},_layer:null,_map:null,_id:null,_session:null,_url:null,getId:function(){return this._id},getLayer:function(){return this._layer},getMap:function(){return this._map},getSession:function(){return this._session},getUrl:function(){return this._url},isActive:function(){return this._session?!0:!1}},r.marker=r.marker||{},r.marker.Base=function(){},r.marker.Base.mixin=function(t){r.utils.extend(r.marker.Base.prototype,t)},r.marker.Base.prototype={constructor:function(){},_active:null,_clickable:null,_draggable:null,_icon:null,_id:null,_map:null,_marker:null,_popup:null,_position:null,getIcon:function(){return this._icon},getId:function(){return this._id},getMap:function(){return this._map},getMarker:function(){return this._marker},getPopup:function(){return this._popup},getPosition:function(){return this._position},hasPopup:function(){return this._popup?!0:!1},isActive:function(){return this._active},isClickable:function(){return this._clickable},isDraggable:function(){return this._draggable},isPopupActive:function(){return this._popup&&this._popup.maptiks?this._popup.maptiks._active:!1}},r.popup=r.popup||{},r.popup.Base=function(){},r.popup.Base.mixin=function(t){r.utils.extend(r.popup.Base.prototype,t)},r.popup.Base.prototype={constructor:function(){},_active:null,_content:null,_map:null,_id:null,_marker:null,_popup:null,_position:null,getContent:function(){return this._content},getId:function(){return this._id},getMap:function(){return this._map},getMarker:function(){return this._marker},getMarkerIcon:function(){return this._marker?this._marker.maptiks._icon:null},getPopup:function(){return this._popup},getPosition:function(){return this._position},hasMarker:function(){return this._marker?!0:!1},isActive:function(){return this._active}},r.source=r.source||{},r.source.Base=function(){},r.source.Base.mixin=function(t){r.utils.extend(r.source.Base.prototype,t)},r.source.Base.prototype={constructor:function(){},_layers:null,_map:null,_source:null,_url:null,getActiveLayers:function(){for(var t=[],e=0;e<this._layers.length;e++)this._layers[e].maptiks._session&&t.push(this._layers[e]);return t},getInactiveLayers:function(){for(var t=[],e=0;e<this._layers.length;e++)this._layers[e].maptiks._session||t.push(this._layers[e]);return t},getLayers:function(){return this._layers},getMap:function(){return this._map},getSource:function(){return this._source},getUrl:function(){return this._url},isActive:function(){return this.getActiveLayers().length?!0:!1}},r.utils={convertXYZtoLatLng:function(t,e,i,n){var r,a,o,s=Math.pow(2,i),c=e+.5;return n&&(c=s-c),r=(t+.5)/s*360-180,a=Math.atan(Math.sinh(Math.PI*(1-2*c/s))),o=a*(180/Math.PI),o>90||-90>o?void 0:{lat:o,lng:r}},generateUUID:function(){var t,e,i=(new Date).getTime();return t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){return e=(i+16*Math.random())%16|0,i=Math.floor(i/16),("x"==t?e:7&e|8).toString(16)})},generateXYZUrl:function(t){var e=t.match(/^(?:(?:https?|ftp):\/\/)[a-z]\./),i=t.match(/\/([0-9]|1[0-9]|2[0-9])\/[-0-9]+\/[0-9]+/);return t=t.split(i[0]),t=t[0]+"/{z}/{x}/{y}"+t[1],e&&(t=t.split(e[0]),e=e[0].slice(0,-2),e+="{s}.",t=e+t[1]),t},getBaseUrl:function(t){var e=t.indexOf("?"),i=t.substring(0,-1!=e?e:t.length).toLowerCase();return i=i.match(/\/\/(www\.)?(([^\/]*)(\/#\/)?([^#]+))/),i=i[2].replace(/(\/(index|default)\.[a-z]{3,4})?$|(\/)?$/,"")},inherits:function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t},extend:function(t,e){for(var i in t)t.hasOwnProperty(i)&&"prototype"!==i&&!e[i]&&(e[i]=t[i]);return e},onDOMReady:function(t,e){document.addEventListener?document.addEventListener("DOMContentLoaded",function(){for(var i=0;i<e.length;i++)e[i].apply(t)}):document.attachEvent&&document.attachEvent("onreadystatechange",function(){for(var i=0;i<e.length;i++)e[i].apply(t)})},pushUnique:function(t,e){return-1==t.indexOf(e)?(t.push(e),!0):!1},createTimer:function(t){return t._timer=t._timer||{},t._timer.stop=function(){var e=(new Date).getTime(),i=e-this._startTime;return delete t._timer,i},t._timer._startTime=(new Date).getTime(),t},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,i){var n=e[i];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(e)),n})},truncateCoordinate:function(t,e){return(null===e||void 0===e||0>e)&&(e=5),Number(t.toFixed(e))},warn:function(t){return e?e.warn(t):void 0}},r.utils.warn("The following options will be depreciated in future versions.\nhttps://analytics.maptiks.com/#/help/\nsa_id    --> maptiks_id\ntrack_id --> maptiks.trackcode")}(window,window.console,window.module,window.define),function(t,e){"use strict";function i(){u._initialTimeout=100,u._initialTime=(new Date).getTime(),u.trackMapSession(),u._zoom=u.getMapState().zoom,u._map.on("moveend",u.trackPanZoom,u),u._map.on("layeradd",function(t){n(t)}),u._map.on("layerremove",function(t){n(t)})}function n(t){var e=t.layer||t.target;"layeradd"===t.type?(e._tiles&&e._url&&r(e),e._icon&&e._latlng&&o(e),e._content&&e._latlng&&c(e)):"layerremove"===t.type&&(e._tiles&&e._url&&u.trackLayerRemove(e?e.maptiks:null),e._content&&e._latlng&&u.trackPopupRemove(e?e.maptiks:null))}function r(e){var i,n,r=e.options?e.options.id||null:null,o=e.options?e.options.layers||null:null;e.maptiks=e.maptiks||{},i=e.maptiks,t.layer.Base.mixin(i),i._map=u._map,i._layer=e,i._url=r?e._url.replace("{id}",r):o?e._url+"?layers="+o:e._url,n=e.options.maptiks_id||e.options.sa_id||i._url,i._id=n,u.trackLayerAdd(i),e.on("loading",function(){i=t.utils.createTimer(i)}),e.on("load",function(){u.trackLayerLoad(i)}),e.on("tileloaderror",a,u)}function a(e){var i,n,r,a,o=e.target,s=e.tile,c=(o.options.tileSize||256)/2,p=t.utils.truncateCoordinate;o=o.maptiks,i=parseInt(s.style.left.replace("px",""),10)+c,n=parseInt(s.style.top.replace("px",""),10)+c,r=u._map.containerPointToLayerPoint([n,i]),a=u._map.layerPointToLatLng([r.y,r.x]),u.trackTileError(o,[p(a.lng),p(a.lat)],s.src)}function o(e){var i,n=t.utils.truncateCoordinate;e.maptiks=e.maptiks||{},i=e.maptiks,t.marker.Base.mixin(i),i._map=u._map,i._marker=e,i._position=[n(e.getLatLng().lng),n(e.getLatLng().lat)]||null,i._icon=e._icon?e._icon.src:null,i._clickable=e.options.clickable||!0,i._draggable=e.options.draggable||!1,i._id=e.options.maptiks_id||i._icon||i._position||null,setTimeout(function(){i._popup=e._popup||null},0),u.trackMarkerAdd(i),e.on("move",function(){s(i)}),e.on("click",function(){s(i),u.trackMarkerClick(i)}),e.on("remove",function(){s(i),u.trackMarkerRemove(i)}),e.on("dragstart",function(){s(i);var n=i._position;i._timer=t.utils.createTimer(i._timer),e.once("dragend",function(){s(i),u.trackMarkerDrag(i,n)})})}function s(e){var i=t.utils.truncateCoordinate;e._position=[i(e._marker.getLatLng().lng),i(e._marker.getLatLng().lat)],e._icon=e._marker._icon?e._marker._icon.src:null}function c(e){var i,n=t.utils.truncateCoordinate;e.maptiks=e.maptiks||{},i=e.maptiks,t.popup.Base.mixin(i),i._content=e.getContent?e.getContent():e._content,i._map=u._map,i._popup=e,i._marker=e._source||null,i._position=[n(e.getLatLng?e.getLatLng().lng:e._latlng.lng),n(e.getLatLng?e.getLatLng().lat:e._latlng.lat)],i._id=e.options.maptiks_id||i.getMarkerIcon()||i._position,i._marker&&(i._marker.maptiks._popup=e),u.trackPopupAdd(i),window.addEventListener?i._popup._contentNode.addEventListener("click",function r(){document.activeElement.href&&(i._popup._contentNode.removeEventListener("click",r),u.trackPopupNavigate(i,document.activeElement.href))}):window.attachEvent&&i._popup._contentNode.attachEvent("onclick",function a(){document.activeElement.href&&(i._popup._contentNode.detachEvent("onclick",a),u.trackPopupNavigate(i,document.activeElement.href))})}var u;e.Map.addInitHook(function(){var e=t.trackcode||this.options.maptiks_trackcode||this.options.track_id||null;e&&!this.options.maptiks_notrack&&(this.maptiks=new t.track.Base({id:this.options.maptiks_id||this.options.sa_id||t.utils.getBaseUrl(window.location.href)+"?mapDiv="+this._container.id,library:"leaflet",map:this,session:t.utils.generateUUID(),trackcode:e,debug:t.debug||this.options.maptiks_debug,standalone:t.standalone||this.options.maptiks_standalone,getMapState:l}),u=this.maptiks,t.track.Map.mixin(u),t.track.Layer.mixin(u),u._layers=[],t.track.Marker.mixin(u),u._markers=[],t.track.Popup.mixin(u),u._popups=[]),u&&(void 0===this.getZoom()?this.once("load",i,u):i())});var p=e.TileLayer.prototype._tileOnError;e.TileLayer.prototype._tileOnError=function(){var t=this._layer||this,e=arguments[1]||this;t.fire("tileloaderror",{tile:e}),p.apply(this,arguments)},t.utils.inherits(e.TileLayer.prototype._tileOnError,p);var l=function(){var e=this._map.getCenter(),i=this._map.getBounds(),n=i.getNorthEast(),r=i.getSouthWest(),a=t.utils.truncateCoordinate;return{bbox:[a(r.lng),a(r.lat),a(n.lng),a(n.lat)],center:[a(e.lng),a(e.lat)],zoom:this._map.getZoom()}}}(window.maptiks,window.L);